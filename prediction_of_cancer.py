# -*- coding: utf-8 -*-
"""prediction of cancer.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/180_g4_vDxhPO3AwopUHUKLAtyymt79cr
"""

import pandas as pd
from sklearn.model_selection import train_test_split
from sklearn.ensemble import RandomForestClassifier
import joblib

# Load your dataset
df = pd.read_csv('cancer_prediction.csv')

# Prepare Features and Target
X = df.drop('Diagnosis', axis=1)
y = df['Diagnosis']

# Train the model
model = RandomForestClassifier(n_estimators=100, random_state=42)
model.fit(X, y)

# Save the model and the columns for the app
joblib.dump(model, 'cancer_model.joblib')
joblib.dump(X.columns.tolist(), 'model_columns.joblib')

print("Model trained and saved as cancer_model.joblib")

"""streamlit app"""

!pip install streamlit

import streamlit as st
import pandas as pd
import joblib
import numpy as np

# Load the saved model
try:
    model = joblib.load('cancer_model.joblib')
    model_columns = joblib.load('model_columns.joblib')
except:
    st.error("Model file not found. Please train the model first.")

# Page configuration
st.set_page_config(page_title="Cancer Risk Prediction Demo", layout="wide")

# Custom Styling
st.markdown("""
    <style>
    .main { background-color: #f5f7f9; }
    .stButton>button { width: 100%; border-radius: 5px; height: 3em; background-color: #ff4b4b; color: white; }
    .report-card { background-color: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
    """, unsafe_allow_html=True)

st.title("üè• Oncology Risk Assessment Dashboard")
st.markdown("---")

# Sidebar for Input
st.sidebar.header("Patient Demographics & Clinical Data")

def user_input_features():
    age = st.sidebar.slider("Age", 18, 100, 50)
    gender = st.sidebar.selectbox("Gender", ("Male", "Female"))
    bmi = st.sidebar.number_input("BMI (Body Mass Index)", 10.0, 50.0, 25.0)
    smoking = st.sidebar.selectbox("Smoking Status", ("Non-smoker", "Smoker"))
    genetic_risk = st.sidebar.selectbox("Genetic Risk Level", ("Low", "Medium", "High"))
    physical_activity = st.sidebar.slider("Physical Activity (hrs/week)", 0.0, 10.0, 5.0)
    alcohol = st.sidebar.slider("Alcohol Intake (units/week)", 0.0, 5.0, 1.0)
    cancer_history = st.sidebar.selectbox("Family Cancer History", ("No", "Yes"))

    # Mapping inputs to model format
    data = {
        'Age': age,
        'Gender': 1 if gender == "Male" else 0,
        'BMI': bmi,
        'Smoking': 1 if smoking == "Smoker" else 0,
        'GeneticRisk': 0 if genetic_risk == "Low" else (1 if genetic_risk == "Medium" else 2),
        'PhysicalActivity': physical_activity,
        'AlcoholIntake': alcohol,
        'CancerHistory': 1 if cancer_history == "Yes" else 0
    }
    return pd.DataFrame(data, index=[0])

input_df = user_input_features()

# Displaying Input Summary
col1, col2 = st.columns([1, 2])

with col1:
    st.subheader("Patient Profile Summary")
    st.write(input_df.T.rename(columns={0: 'Value'}))

with col2:
    st.subheader("Prediction Analysis")
    if st.button("Generate Risk Assessment"):
        # Prediction
        prediction = model.predict(input_df)
        prediction_proba = model.predict_proba(input_df)

        risk_score = prediction_proba[0][1] * 100

        # Display Results
        if prediction[0] == 1:
            st.error(f"### High Risk Detected")
            st.metric("Probability of Cancer", f"{risk_score:.2f}%")
            st.warning("Recommendation: Please consult an oncologist for a comprehensive screening.")
        else:
            st.success(f"### Low Risk Detected")
            st.metric("Probability of Cancer", f"{risk_score:.2f}%")
            st.info("Recommendation: Maintain a healthy lifestyle and continue regular check-ups.")

        # Progress bar for visual
        st.write("Risk Score Visualizer:")
        st.progress(int(risk_score))

st.markdown("---")
st.caption("Disclaimer: This tool is for demonstration and educational purposes only. It should not be used as a substitute for professional medical advice, diagnosis, or treatment.")